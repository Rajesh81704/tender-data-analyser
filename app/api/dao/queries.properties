# SQL Queries Properties File
# Format: query.name=SQL statement

query.health.check=SELECT 1 as status
query.tender.insert_tender_main=INSERT INTO tender_master ( tndr_source_file, dst_source_file, dept_source_file, crt_dt, crt_user ) VALUES (%s, %s, %s, %s, %s) RETURNING tndr_pk;
query.tender.insert_tender_dtls=INSERT INTO "TENDER_DATA_DTLS" ( tndr_pk, "DISTRICT_CODE", "WORK_CODE", "DEPARTMENT_CODE", "PROJECT_NAME", "SANCTION_COST", "SANCTION_DATE", "FUND_RECEIVED", "FUND_RECEIVED_DATE", "LAND_RECEIVED_DATE", "WIP_PREVIOUS_YEAR", "WIP_CURRENT_YEAR", "WIP_CURRENT_MONTH", "WIP_TOTAL", "PHYSICAL_PROGRESS", "PHYSICAL_PROGRESS_REMARK" ) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s)
query.tender.insert_district_dtls=INSERT INTO "DISTRICT_DETAILS" ( tndr_pk, "DIST_CODE", "DIST_NAME", "ZONE" ) VALUES (%s, %s, %s, %s)
query.tender.insert_dept_dtls=INSERT INTO "DEPT_DTLS" ( tndr_pk, "SR_NO", "DEPT_NAME", "SUB_DEPT_NAME", "DEPT_SUB_DEPT_CODE" ) VALUES (%s, %s, %s, %s, %s)

query.dashboard.get_stats=SELECT COUNT(*) AS total_projects, COUNT(DISTINCT "DEPARTMENT_CODE") AS total_departments, ROUND(COALESCE(SUM("SANCTION_COST"), 0)::numeric / 100, 3) AS total_sanction_cost, ROUND(COALESCE(SUM("FUND_RECEIVED"), 0)::numeric / 100, 3) AS total_fund_received, ROUND( (COALESCE(SUM("SANCTION_COST"), 0) - COALESCE(SUM("FUND_RECEIVED"), 0))::numeric / 100, 3 ) AS total_fund_pending, ROUND( (COALESCE(SUM("FUND_RECEIVED"), 0) - COALESCE(SUM("WIP_TOTAL"), 0))::numeric / 100, 3 ) AS total_fund_pending_to_utilize, ROUND(COALESCE(SUM("WIP_TOTAL"), 0)::numeric / 100, 3) AS total_fund_utilized, ROUND(COALESCE(AVG("PHYSICAL_PROGRESS"), 0)::numeric, 3) AS avg_physical_progress FROM "TENDER_DATA_DTLS" tdd where tdd.tndr_pk=%s;
query.dashboard.get_dept_wise_stats=SELECT d."DEPT_SUB_DEPT_CODE", d."DEPT_NAME", d."SUB_DEPT_NAME", COUNT(t."TDM_PK") as total_projects, COUNT(DISTINCT t."DEPARTMENT_CODE") as total_departments, round(COALESCE(SUM(t."SANCTION_COST"), 0)::numeric/100, 3) as total_sanction_cost, round(COALESCE(SUM(t."FUND_RECEIVED"), 0)::numeric/100, 3) as total_fund_received, round((COALESCE(SUM(t."SANCTION_COST"), 0)::numeric - COALESCE(SUM(t."FUND_RECEIVED"), 0)::numeric)::numeric, 3) as total_fund_pending, round((COALESCE(SUM(t."FUND_RECEIVED"), 0)::numeric - COALESCE(SUM(t."WIP_TOTAL"), 0)::numeric)::numeric, 3) as total_fund_pending_to_utilize, COALESCE(SUM(t."WIP_TOTAL"), 0) as total_fund_utilized, round(COALESCE(AVG(t."PHYSICAL_PROGRESS"), 0)::numeric, 3) as avg_physical_progress FROM "DEPT_DTLS" d LEFT JOIN "TENDER_DATA_DTLS" t ON d.tndr_pk = t.tndr_pk AND d."DEPT_SUB_DEPT_CODE" = t."DEPARTMENT_CODE"
query.dashboard.get_dept_projects=SELECT mst.tndr_pk, mst.tndr_source_file, mst.dst_source_file, mst.dept_source_file, mst.crt_dt, mst.crt_user, d."DEPT_SUB_DEPT_CODE", d."DEPT_NAME", d."SUB_DEPT_NAME", t."TDM_PK", dist."DIST_NAME", t."WORK_CODE", t."DEPARTMENT_CODE", t."PROJECT_NAME", t."SANCTION_COST", t."SANCTION_DATE", t."FUND_RECEIVED", t."FUND_RECEIVED_DATE", t."LAND_RECEIVED_DATE", t."WIP_PREVIOUS_YEAR", t."WIP_CURRENT_YEAR", t."WIP_CURRENT_MONTH", t."WIP_TOTAL", t."PHYSICAL_PROGRESS", t."PHYSICAL_PROGRESS_REMARK" FROM tender_master mst INNER JOIN "TENDER_DATA_DTLS" t ON mst.tndr_pk = t.tndr_pk INNER JOIN "DEPT_DTLS" d ON t.tndr_pk = d.tndr_pk AND t."DEPARTMENT_CODE" = d."DEPT_SUB_DEPT_CODE" INNER JOIN "DISTRICT_DETAILS" dist ON t."DISTRICT_CODE" = dist."DIST_CODE"
query.dashboard.get_fund_flow=SELECT ROUND(COALESCE(SUM(NULLIF("SANCTION_COST", 'NaN'::float)), 0)::NUMERIC, 2) AS sanctioned, ROUND(COALESCE(SUM(NULLIF("FUND_RECEIVED", 'NaN'::float)), 0)::NUMERIC, 2) AS received, ROUND(COALESCE(SUM(NULLIF("WIP_PREVIOUS_YEAR", 'NaN'::float)), 0)::NUMERIC, 2) AS utilized_previous, ROUND(COALESCE(SUM(NULLIF("WIP_CURRENT_YEAR", 'NaN'::float)), 0)::NUMERIC, 2) AS utilized_current, ROUND(COALESCE(SUM(NULLIF("WIP_TOTAL", 'NaN'::float)), 0)::NUMERIC, 2) AS total_utilized, ROUND((COALESCE(SUM(NULLIF("SANCTION_COST", 'NaN'::float)), 0) - COALESCE(SUM(NULLIF("FUND_RECEIVED", 'NaN'::float)), 0))::NUMERIC, 2) AS amount_to_be_received, ROUND((COALESCE(SUM(NULLIF("FUND_RECEIVED", 'NaN'::float)), 0) - COALESCE(SUM(NULLIF("WIP_TOTAL", 'NaN'::float)), 0))::NUMERIC, 2) AS amount_to_be_utilized FROM "TENDER_DATA_DTLS" WHERE tndr_pk = %s
query.dashboard.get_dept_completion_status=SELECT d."DEPT_NAME" AS department, t."PHYSICAL_PROGRESS_REMARK" AS status_remark, t."PHYSICAL_PROGRESS" AS completion_status, COUNT(*) AS project_count FROM "TENDER_DATA_DTLS" t INNER JOIN "DEPT_DTLS" d ON t.tndr_pk = d.tndr_pk AND t."DEPARTMENT_CODE" = d."DEPT_SUB_DEPT_CODE"
query.dashboard.get_project_wise_details=SELECT t."WORK_CODE" AS work_code, t."PROJECT_NAME" AS work_name, d."DEPT_NAME" AS department, t."PHYSICAL_PROGRESS_REMARK" AS completion_status, COALESCE(NULLIF(t."SANCTION_COST", 'NaN'::float), 0) AS sanction_cost, COALESCE(NULLIF(t."FUND_RECEIVED", 'NaN'::float), 0) AS fund_received, COALESCE(NULLIF(t."WIP_TOTAL", 'NaN'::float), 0) AS total_wip FROM "TENDER_DATA_DTLS" t INNER JOIN "DEPT_DTLS" d ON t.tndr_pk = d.tndr_pk AND t."DEPARTMENT_CODE" = d."DEPT_SUB_DEPT_CODE" WHERE t.tndr_pk = %s ORDER BY t."WORK_CODE"
query.dashboard.get_project_stage_summary=SELECT t."PROJECT_NAME" AS project_name, ROUND(COALESCE(SUM(NULLIF(t."SANCTION_COST", 'NaN'::float)), 0)::NUMERIC, 2) AS sanctioned, ROUND(COALESCE(SUM(NULLIF(t."FUND_RECEIVED", 'NaN'::float)), 0)::NUMERIC, 3) AS received, d."DEPT_NAME" AS department, COALESCE(t."PHYSICAL_PROGRESS", 0) AS completion_percentage, CASE WHEN COALESCE(t."PHYSICAL_PROGRESS", 0) >= 100 THEN 'Completed' WHEN COALESCE(t."PHYSICAL_PROGRESS", 0) >= 75 THEN '>=75%%' WHEN COALESCE(t."PHYSICAL_PROGRESS", 0) >= 50 THEN '>=50%%' WHEN COALESCE(t."PHYSICAL_PROGRESS", 0) >= 25 THEN '>=25%%' ELSE '<25%%' END AS project_stage FROM "TENDER_DATA_DTLS" t INNER JOIN "DEPT_DTLS" d ON t.tndr_pk = d.tndr_pk AND t."DEPARTMENT_CODE" = d."DEPT_SUB_DEPT_CODE" WHERE d."DEPT_NAME" IS NOT NULL
query.dashboard.get_all_tender_masters=SELECT tndr_pk, tndr_source_file, dst_source_file, dept_source_file, crt_dt, crt_user FROM tender_master ORDER BY crt_dt DESC